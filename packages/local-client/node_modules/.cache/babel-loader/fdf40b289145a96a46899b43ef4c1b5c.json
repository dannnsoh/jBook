{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Ryzen/Desktop/jbook/packages/local-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Ryzen/Desktop/jbook/packages/local-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import*as esbuild from\"esbuild-wasm\";import{unpkgPathPlugin}from\"./plugins/unpkg-path-plugin\";import{fetchPlugin}from\"./plugins/fetch-plugin\";// to check if esbuild has been initialized\nvar service;var bundle=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(rawCode){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(service){_context.next=6;break;}_context.next=3;return esbuild.initialize({worker:true,wasmURL:\"https://unpkg.com/esbuild-wasm/esbuild.wasm\"});case 3:service=true;_context.next=0;break;case 6:_context.prev=6;_context.next=9;return esbuild.build({entryPoints:[\"index.js\"],bundle:true,write:false,plugins:[unpkgPathPlugin(),fetchPlugin(rawCode)],define:{\"process.env.NODE_ENV\":'\"production\"',global:\"window\"},// configure esbuild to use _React for the show() function to prevent naming collision with \"import React ...\"\njsxFactory:\"_React.createElement\",jsxFragment:\"_React.Fragment\"});case 9:result=_context.sent;return _context.abrupt(\"return\",{code:result.outputFiles[0].text,err:\"\"});case 13:_context.prev=13;_context.t0=_context[\"catch\"](6);if(!(_context.t0 instanceof Error)){_context.next=19;break;}return _context.abrupt(\"return\",{code:\"\",err:_context.t0.message});case 19:return _context.abrupt(\"return\",{code:\"\",err:\"An error has occurred!\"});case 20:case\"end\":return _context.stop();}}},_callee,null,[[6,13]]);}));return function bundle(_x){return _ref.apply(this,arguments);};}();export default bundle;","map":{"version":3,"sources":["C:/Users/Ryzen/Desktop/jbook/packages/local-client/src/bundler/index.ts"],"names":["esbuild","unpkgPathPlugin","fetchPlugin","service","bundle","rawCode","initialize","worker","wasmURL","build","entryPoints","write","plugins","define","global","jsxFactory","jsxFragment","result","code","outputFiles","text","err","Error","message"],"mappings":"+UAAA,MAAO,GAAKA,CAAAA,OAAZ,KAAyB,cAAzB,CACA,OAASC,eAAT,KAAgC,6BAAhC,CACA,OAASC,WAAT,KAA4B,wBAA5B,CAEA;AACA,GAAIC,CAAAA,OAAJ,CAEA,GAAMC,CAAAA,MAAM,0FAAG,iBAAOC,OAAP,gIACNF,OADM,+CAGPH,CAAAA,OAAO,CAACM,UAAR,CAAmB,CACxBC,MAAM,CAAE,IADgB,CAExBC,OAAO,CAAE,6CAFe,CAAnB,CAHO,QAObL,OAAO,CAAG,IAAV,CAPa,mEAWQH,CAAAA,OAAO,CAACS,KAAR,CAAc,CAClCC,WAAW,CAAE,CAAE,UAAF,CADqB,CAElCN,MAAM,CAAE,IAF0B,CAGlCO,KAAK,CAAE,KAH2B,CAIlCC,OAAO,CAAE,CAAEX,eAAe,EAAjB,CAAqBC,WAAW,CAACG,OAAD,CAAhC,CAJyB,CAKlCQ,MAAM,CACL,CACC,uBAAwB,cADzB,CAECC,MAAM,CAAE,QAFT,CANiC,CAUlC;AACAC,UAAU,CAAE,sBAXsB,CAYlCC,WAAW,CAAE,iBAZqB,CAAd,CAXR,QAWPC,MAXO,+CAyBN,CACNC,IAAI,CAAED,MAAM,CAACE,WAAP,CAAmB,CAAnB,EAAsBC,IADtB,CAENC,GAAG,CAAE,EAFC,CAzBM,iEA8BT,sBAAeC,CAAAA,KA9BN,2DA+BL,CACNJ,IAAI,CAAE,EADA,CAENG,GAAG,CAAE,YAAIE,OAFH,CA/BK,0CAoCL,CACNL,IAAI,CAAE,EADA,CAENG,GAAG,CAAE,wBAFC,CApCK,uEAAH,kBAANjB,CAAAA,MAAM,4CAAZ,CA4CA,cAAeA,CAAAA,MAAf","sourcesContent":["import * as esbuild from \"esbuild-wasm\";\r\nimport { unpkgPathPlugin } from \"./plugins/unpkg-path-plugin\";\r\nimport { fetchPlugin } from \"./plugins/fetch-plugin\";\r\n\r\n// to check if esbuild has been initialized\r\nlet service: boolean;\r\n\r\nconst bundle = async (rawCode: string) => {\r\n\twhile (!service) {\r\n\t\t// initialize esbuild\r\n\t\tawait esbuild.initialize({\r\n\t\t\tworker: true,\r\n\t\t\twasmURL: \"https://unpkg.com/esbuild-wasm/esbuild.wasm\"\r\n\t\t});\r\n\t\tservice = true;\r\n\t}\r\n\t// bundle code\r\n\ttry {\r\n\t\tconst result = await esbuild.build({\r\n\t\t\tentryPoints: [ \"index.js\" ],\r\n\t\t\tbundle: true,\r\n\t\t\twrite: false,\r\n\t\t\tplugins: [ unpkgPathPlugin(), fetchPlugin(rawCode) ],\r\n\t\t\tdefine:\r\n\t\t\t\t{\r\n\t\t\t\t\t\"process.env.NODE_ENV\": '\"production\"',\r\n\t\t\t\t\tglobal: \"window\"\r\n\t\t\t\t},\r\n\t\t\t// configure esbuild to use _React for the show() function to prevent naming collision with \"import React ...\"\r\n\t\t\tjsxFactory: \"_React.createElement\",\r\n\t\t\tjsxFragment: \"_React.Fragment\"\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tcode: result.outputFiles[0].text,\r\n\t\t\terr: \"\"\r\n\t\t};\r\n\t} catch (err) {\r\n\t\tif (err instanceof Error) {\r\n\t\t\treturn {\r\n\t\t\t\tcode: \"\",\r\n\t\t\t\terr: err.message\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tcode: \"\",\r\n\t\t\t\terr: \"An error has occurred!\"\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport default bundle;\r\n"]},"metadata":{},"sourceType":"module"}